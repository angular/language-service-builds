{"version":3,"file":"ts_plugin.js","sourceRoot":"","sources":["../../../../../packages/language-service/src/ts_plugin.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport * as ts from 'typescript';\n\nimport {createLanguageService} from './language_service';\nimport {Completion, Diagnostic, DiagnosticMessageChain, LanguageService, LanguageServiceHost} from './types';\nimport {TypeScriptServiceHost} from './typescript_host';\n\nconst projectHostMap = new WeakMap<any, TypeScriptServiceHost>();\n\nexport function getExternalFiles(project: any): string[]|undefined {\n  const host = projectHostMap.get(project);\n  if (host) {\n    return host.getTemplateReferences();\n  }\n}\n\nexport function create(info: any /* ts.server.PluginCreateInfo */): ts.LanguageService {\n  // Create the proxy\n  const proxy: ts.LanguageService = Object.create(null);\n  let oldLS: ts.LanguageService = info.languageService;\n\n  function tryCall<T>(fileName: string | undefined, callback: () => T): T {\n    if (fileName && !oldLS.getProgram().getSourceFile(fileName)) {\n      return undefined as any as T;\n    }\n    try {\n      return callback();\n    } catch (e) {\n      return undefined as any as T;\n    }\n  }\n\n  function tryFilenameCall<T>(m: (fileName: string) => T): (fileName: string) => T {\n    return fileName => tryCall(fileName, () => <T>(m.call(ls, fileName)));\n  }\n\n  function tryFilenameOneCall<T, P>(m: (fileName: string, p: P) => T): (filename: string, p: P) =>\n      T {\n    return (fileName, p) => tryCall(fileName, () => <T>(m.call(ls, fileName, p)));\n  }\n\n  function tryFilenameTwoCall<T, P1, P2>(m: (fileName: string, p1: P1, p2: P2) => T): (\n      filename: string, p1: P1, p2: P2) => T {\n    return (fileName, p1, p2) => tryCall(fileName, () => <T>(m.call(ls, fileName, p1, p2)));\n  }\n\n  function tryFilenameThreeCall<T, P1, P2, P3>(m: (fileName: string, p1: P1, p2: P2, p3: P3) => T):\n      (filename: string, p1: P1, p2: P2, p3: P3) => T {\n    return (fileName, p1, p2, p3) => tryCall(fileName, () => <T>(m.call(ls, fileName, p1, p2, p3)));\n  }\n\n  function tryFilenameFourCall<T, P1, P2, P3, P4>(\n      m: (fileName: string, p1: P1, p2: P2, p3: P3, p4: P4) =>\n          T): (fileName: string, p1: P1, p2: P2, p3: P3, p4: P4) => T {\n    return (fileName, p1, p2, p3, p4) =>\n               tryCall(fileName, () => <T>(m.call(ls, fileName, p1, p2, p3, p4)));\n  }\n\n  function typescriptOnly(ls: ts.LanguageService): ts.LanguageService {\n    return {\n      cleanupSemanticCache: () => ls.cleanupSemanticCache(),\n      getSyntacticDiagnostics: tryFilenameCall(ls.getSyntacticDiagnostics),\n      getSemanticDiagnostics: tryFilenameCall(ls.getSemanticDiagnostics),\n      getCompilerOptionsDiagnostics: () => ls.getCompilerOptionsDiagnostics(),\n      getSyntacticClassifications: tryFilenameOneCall(ls.getSemanticClassifications),\n      getSemanticClassifications: tryFilenameOneCall(ls.getSemanticClassifications),\n      getEncodedSyntacticClassifications: tryFilenameOneCall(ls.getEncodedSyntacticClassifications),\n      getEncodedSemanticClassifications: tryFilenameOneCall(ls.getEncodedSemanticClassifications),\n      getCompletionsAtPosition: tryFilenameTwoCall(ls.getCompletionsAtPosition),\n      getCompletionEntryDetails: tryFilenameFourCall(ls.getCompletionEntryDetails),\n      getCompletionEntrySymbol: tryFilenameThreeCall(ls.getCompletionEntrySymbol),\n      getQuickInfoAtPosition: tryFilenameOneCall(ls.getQuickInfoAtPosition),\n      getNameOrDottedNameSpan: tryFilenameTwoCall(ls.getNameOrDottedNameSpan),\n      getBreakpointStatementAtPosition: tryFilenameOneCall(ls.getBreakpointStatementAtPosition),\n      getSignatureHelpItems: tryFilenameOneCall(ls.getSignatureHelpItems),\n      getRenameInfo: tryFilenameOneCall(ls.getRenameInfo),\n      findRenameLocations: tryFilenameThreeCall(ls.findRenameLocations),\n      getDefinitionAtPosition: tryFilenameOneCall(ls.getDefinitionAtPosition),\n      getTypeDefinitionAtPosition: tryFilenameOneCall(ls.getTypeDefinitionAtPosition),\n      getImplementationAtPosition: tryFilenameOneCall(ls.getImplementationAtPosition),\n      getReferencesAtPosition: tryFilenameOneCall(ls.getReferencesAtPosition),\n      findReferences: tryFilenameOneCall(ls.findReferences),\n      getDocumentHighlights: tryFilenameTwoCall(ls.getDocumentHighlights),\n      /** @deprecated */\n      getOccurrencesAtPosition: tryFilenameOneCall(ls.getOccurrencesAtPosition),\n      getNavigateToItems:\n          (searchValue, maxResultCount, fileName, excludeDtsFiles) => tryCall(\n              fileName,\n              () => ls.getNavigateToItems(searchValue, maxResultCount, fileName, excludeDtsFiles)),\n      getNavigationBarItems: tryFilenameCall(ls.getNavigationBarItems),\n      getNavigationTree: tryFilenameCall(ls.getNavigationTree),\n      getOutliningSpans: tryFilenameCall(ls.getOutliningSpans),\n      getTodoComments: tryFilenameOneCall(ls.getTodoComments),\n      getBraceMatchingAtPosition: tryFilenameOneCall(ls.getBraceMatchingAtPosition),\n      getIndentationAtPosition: tryFilenameTwoCall(ls.getIndentationAtPosition),\n      getFormattingEditsForRange: tryFilenameThreeCall(ls.getFormattingEditsForRange),\n      getFormattingEditsForDocument: tryFilenameOneCall(ls.getFormattingEditsForDocument),\n      getFormattingEditsAfterKeystroke: tryFilenameThreeCall(ls.getFormattingEditsAfterKeystroke),\n      getDocCommentTemplateAtPosition: tryFilenameOneCall(ls.getDocCommentTemplateAtPosition),\n      isValidBraceCompletionAtPosition: tryFilenameTwoCall(ls.isValidBraceCompletionAtPosition),\n      getSpanOfEnclosingComment: tryFilenameTwoCall(ls.getSpanOfEnclosingComment),\n      getCodeFixesAtPosition: tryFilenameFourCall(ls.getCodeFixesAtPosition),\n      applyCodeActionCommand:\n          <any>((action: any) => tryCall(undefined, () => ls.applyCodeActionCommand(action))),\n      getEmitOutput: tryFilenameCall(ls.getEmitOutput),\n      getProgram: () => ls.getProgram(),\n      dispose: () => ls.dispose(),\n      getApplicableRefactors: tryFilenameOneCall(ls.getApplicableRefactors),\n      getEditsForRefactor: tryFilenameFourCall(ls.getEditsForRefactor),\n      getDefinitionAndBoundSpan: tryFilenameOneCall(ls.getDefinitionAndBoundSpan),\n      getCombinedCodeFix:\n          (scope: ts.CombinedCodeFixScope, fixId: {}, formatOptions: ts.FormatCodeSettings) =>\n              tryCall(undefined, () => ls.getCombinedCodeFix(scope, fixId, formatOptions))\n    };\n  }\n\n  oldLS = typescriptOnly(oldLS);\n\n  for (const k in oldLS) {\n    (<any>proxy)[k] = function() { return (oldLS as any)[k].apply(oldLS, arguments); };\n  }\n\n  function completionToEntry(c: Completion): ts.CompletionEntry {\n    return {\n      // TODO: remove any and fix type error.\n      kind: c.kind as any,\n      name: c.name,\n      sortText: c.sort,\n      kindModifiers: ''\n    };\n  }\n\n  function diagnosticChainToDiagnosticChain(chain: DiagnosticMessageChain):\n      ts.DiagnosticMessageChain {\n    return {\n      messageText: chain.message,\n      category: ts.DiagnosticCategory.Error,\n      code: 0,\n      next: chain.next ? diagnosticChainToDiagnosticChain(chain.next) : undefined\n    };\n  }\n\n  function diagnosticMessageToDiagnosticMessageText(message: string | DiagnosticMessageChain):\n      string|ts.DiagnosticMessageChain {\n    if (typeof message === 'string') {\n      return message;\n    }\n    return diagnosticChainToDiagnosticChain(message);\n  }\n\n  function diagnosticToDiagnostic(d: Diagnostic, file: ts.SourceFile): ts.Diagnostic {\n    const result = {\n      file,\n      start: d.span.start,\n      length: d.span.end - d.span.start,\n      messageText: diagnosticMessageToDiagnosticMessageText(d.message),\n      category: ts.DiagnosticCategory.Error,\n      code: 0,\n      source: 'ng'\n    };\n    return result;\n  }\n\n  function tryOperation<T>(attempting: string, callback: () => T): T|null {\n    try {\n      return callback();\n    } catch (e) {\n      info.project.projectService.logger.info(`Failed to ${attempting}: ${e.toString()}`);\n      info.project.projectService.logger.info(`Stack trace: ${e.stack}`);\n      return null;\n    }\n  }\n\n  const serviceHost = new TypeScriptServiceHost(info.languageServiceHost, info.languageService);\n  const ls = createLanguageService(serviceHost as any);\n  serviceHost.setSite(ls);\n  projectHostMap.set(info.project, serviceHost);\n\n  proxy.getCompletionsAtPosition = function(\n      fileName: string, position: number, options: ts.GetCompletionsAtPositionOptions|undefined) {\n    let base = oldLS.getCompletionsAtPosition(fileName, position, options) || {\n      isGlobalCompletion: false,\n      isMemberCompletion: false,\n      isNewIdentifierLocation: false,\n      entries: []\n    };\n    tryOperation('get completions', () => {\n      const results = ls.getCompletionsAt(fileName, position);\n      if (results && results.length) {\n        if (base === undefined) {\n          base = {\n            isGlobalCompletion: false,\n            isMemberCompletion: false,\n            isNewIdentifierLocation: false,\n            entries: []\n          };\n        }\n        for (const entry of results) {\n          base.entries.push(completionToEntry(entry));\n        }\n      }\n    });\n    return base;\n  };\n\n  proxy.getQuickInfoAtPosition = function(fileName: string, position: number): ts.QuickInfo {\n    let base = oldLS.getQuickInfoAtPosition(fileName, position);\n    // TODO(vicb): the tags property has been removed in TS 2.2\n    tryOperation('get quick info', () => {\n      const ours = ls.getHoverAt(fileName, position);\n      if (ours) {\n        const displayParts: ts.SymbolDisplayPart[] = [];\n        for (const part of ours.text) {\n          displayParts.push({kind: part.language || 'angular', text: part.text});\n        }\n        const tags = base && (<any>base).tags;\n        base = <any>{\n          displayParts,\n          documentation: [],\n          kind: 'angular',\n          kindModifiers: 'what does this do?',\n          textSpan: {start: ours.span.start, length: ours.span.end - ours.span.start},\n        };\n        if (tags) {\n          (<any>base).tags = tags;\n        }\n      }\n    });\n\n    return base;\n  };\n\n  proxy.getSemanticDiagnostics = function(fileName: string) {\n    let result = oldLS.getSemanticDiagnostics(fileName);\n    const base = result || [];\n    tryOperation('get diagnostics', () => {\n      info.project.projectService.logger.info(`Computing Angular semantic diagnostics...`);\n      const ours = ls.getDiagnostics(fileName);\n      if (ours && ours.length) {\n        const file = oldLS.getProgram().getSourceFile(fileName);\n        if (file) {\n          base.push.apply(base, ours.map(d => diagnosticToDiagnostic(d, file)));\n        }\n      }\n    });\n\n    return base;\n  };\n\n  proxy.getDefinitionAtPosition = function(\n                                      fileName: string, position: number): ts.DefinitionInfo[] {\n    let base = oldLS.getDefinitionAtPosition(fileName, position);\n    if (base && base.length) {\n      return base;\n    }\n\n    return tryOperation('get definition', () => {\n             const ours = ls.getDefinitionAt(fileName, position);\n             if (ours && ours.length) {\n               base = base || [];\n               for (const loc of ours) {\n                 base.push({\n                   fileName: loc.fileName,\n                   textSpan: {start: loc.span.start, length: loc.span.end - loc.span.start},\n                   name: '',\n                   // TODO: remove any and fix type error.\n                   kind: 'definition' as any,\n                   containerName: loc.fileName,\n                   containerKind: 'file' as any,\n                 });\n               }\n             }\n             return base;\n           }) || [];\n  };\n\n  return proxy;\n}\n"]}